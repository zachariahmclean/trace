<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Call Repeats for Fragments — call_repeats • trace</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Call Repeats for Fragments — call_repeats"><meta name="description" content="This function calls the repeat lengths for a list of fragments."><meta property="og:description" content="This function calls the repeat lengths for a list of fragments."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trace</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/plotting_traces.html">Plotting traces</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Call Repeats for Fragments</h1>

      <div class="d-none name"><code>call_repeats.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calls the repeat lengths for a list of fragments.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">call_repeats</span><span class="op">(</span></span>
<span>  <span class="va">fragments_list</span>,</span>
<span>  assay_size_without_repeat <span class="op">=</span> <span class="fl">87</span>,</span>
<span>  repeat_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  force_whole_repeat_units <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  batch_correction <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  repeat_calling_algorithm <span class="op">=</span> <span class="st">"simple"</span>,</span>
<span>  repeat_calling_algorithm_size_window_around_allele <span class="op">=</span> <span class="va">repeat_size</span> <span class="op">*</span> <span class="fl">5</span>,</span>
<span>  repeat_calling_algorithm_peak_assignment_scan_window <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  repeat_calling_algorithm_size_period <span class="op">=</span> <span class="va">repeat_size</span> <span class="op">*</span> <span class="fl">0.93</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fragments-list">fragments_list<a class="anchor" aria-label="anchor" href="#arg-fragments-list"></a></dt>
<dd><p>A list of fragments_repeats objects containing fragment data.</p></dd>


<dt id="arg-assay-size-without-repeat">assay_size_without_repeat<a class="anchor" aria-label="anchor" href="#arg-assay-size-without-repeat"></a></dt>
<dd><p>An integer specifying the assay size without repeat for repeat calling. This is the length of the sequence flanking the repeat in the PCR product.</p></dd>


<dt id="arg-repeat-size">repeat_size<a class="anchor" aria-label="anchor" href="#arg-repeat-size"></a></dt>
<dd><p>An integer specifying the repeat size for repeat calling. Default is 3.</p></dd>


<dt id="arg-force-whole-repeat-units">force_whole_repeat_units<a class="anchor" aria-label="anchor" href="#arg-force-whole-repeat-units"></a></dt>
<dd><p>A logical value specifying if the peaks should be forced to be whole repeat units apart. Usually the peaks are slightly under the whole repeat unit if left unchanged.</p></dd>


<dt id="arg-batch-correction">batch_correction<a class="anchor" aria-label="anchor" href="#arg-batch-correction"></a></dt>
<dd><p>A logical specifying if the size should be adjusted across fragment analysis runs. Requires metadata to be added to specify samples (<code>"batch_sample_id"</code>) common across runs (<code>"batch_run_id"</code>)(see <code><a href="add_metadata.html">add_metadata()</a></code>).</p></dd>


<dt id="arg-repeat-calling-algorithm">repeat_calling_algorithm<a class="anchor" aria-label="anchor" href="#arg-repeat-calling-algorithm"></a></dt>
<dd><p>A character specifying the repeat calling algorithm. Options: <code>"simple"</code>, <code>"fft"</code>, or <code>"size_period"</code> (see details section for more information on these).</p></dd>


<dt id="arg-repeat-calling-algorithm-size-window-around-allele">repeat_calling_algorithm_size_window_around_allele<a class="anchor" aria-label="anchor" href="#arg-repeat-calling-algorithm-size-window-around-allele"></a></dt>
<dd><p>A numeric value for how big of a window around the tallest peak should be used to find the peak periodicity. Used for both <code>"fft"</code> and <code>"size_period"</code>. For <code>"fft"</code>, you want to make sure that this window is limited to where there are clear peaks. For <code>"size_period"</code>, it will not make a big difference.</p></dd>


<dt id="arg-repeat-calling-algorithm-peak-assignment-scan-window">repeat_calling_algorithm_peak_assignment_scan_window<a class="anchor" aria-label="anchor" href="#arg-repeat-calling-algorithm-peak-assignment-scan-window"></a></dt>
<dd><p>A numeric value for the scan window when assigning the peak. This is used for both <code>"fft"</code> and <code>"size_period"</code>. When the scan period is determined, the algorithm jumps to the predicted scan for the next peak. This value opens a window of the neighboring scans to pick the tallest in.</p></dd>


<dt id="arg-repeat-calling-algorithm-size-period">repeat_calling_algorithm_size_period<a class="anchor" aria-label="anchor" href="#arg-repeat-calling-algorithm-size-period"></a></dt>
<dd><p>A numeric value <code>"size_period"</code> algorithm to set the peak periodicity by bp size. This is the key variable to change for <code>"size_period"</code>. In fragment analysis, the peaks are usually slightly below the actual repeat unit size.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This function modifies list of fragments objects in place with repeats added.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Repeat lengths are calculated from the bp size with several different alternative algorithm or options.</p>
<p>The <code>force_whole_repeat_units</code> option aims to correct for the systematic underestimation in fragment sizes that occurs in capillary electrophoresis. It is independent to the algorithms described below and can be used in conjunction. It modifies repeat lengths in a way that helps align peaks with the underlying repeat pattern, making the repeat lengths whole units (rather than ~0.9 repeats). The calculated repeat lengths start from the main peak's repeat length and increases in increments of the specified <code>repeat_size</code> in either direction.</p>
<p><code>batch_correction</code> involves using common sample(s) across fragment analysis runs to correct systematic batch effects that occur with repeat-containing amplicons in capillary electrophoresis. There are slight fluctuations of size across runs for amplicons containing repeats that result in systematic differences, so if samples are to be analyzed for different runs, the absolute bp size is not comparable unless this batch effect is corrected. This is only relevant when the absolute size of a amplicons are compared for grouping metrics as described in <code><a href="assign_index_peaks.html">assign_index_peaks()</a></code> and <code><a href="add_metadata.html">add_metadata()</a></code> (otherwise instability metrics are all relative and it doesn’t matter that there’s systematic batch effects across runs). This correction can be achieved by running a couple of samples in every fragment analysis run, or having a single run that takes a couple of samples from every run together, thereby linking them. These samples are then indicated in the metadata with <code>batch_run_id</code> (to group samples by fragment analysis run) and <code>batch_sample_id</code> (to enable linking samples across batches).</p>
<p>The <code>simple</code> algorithm is just the repeat size calculated directly from bp. The <code>fft</code> or <code>size_period</code> algorithms both re-call the peaks based on empirically determined (<code>fft</code>) or specified (<code>size_period</code>) periodicity of the peaks. The main application of these algorithms is to solve the issue of contaminating peaks in the expected regular pattern of peaks. The <code>fft</code> approach applies a fourier transform to the peak signal to determine the underlying periodicity of the signal. <code>size_period</code> is similar and simpler, where instead of automatically figuring out the periodicity, we as users specify the periodicity (since we usually know the size distance between repeat units). We can use the periodicity to jump between peaks.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="find_alleles.html">find_alleles()</a></code>, <code><a href="add_metadata.html">add_metadata()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fsa_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cell_line_fsa_list</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span><span class="op">:</span><span class="fl">94</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="find_ladders.html">find_ladders</a></span><span class="op">(</span><span class="va">fsa_list</span>, show_progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fragments_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="find_fragments.html">find_fragments</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fsa_list</span>,</span></span>
<span class="r-in"><span>  min_bp_size <span class="op">=</span> <span class="fl">300</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="find_alleles.html">find_alleles</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fragments_list</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple conversion from bp size to repeat size</span></span></span>
<span class="r-in"><span><span class="fu">call_repeats</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fragments_list</span>,</span></span>
<span class="r-in"><span>  repeat_calling_algorithm <span class="op">=</span> <span class="st">"simple"</span>,</span></span>
<span class="r-in"><span>  assay_size_without_repeat <span class="op">=</span> <span class="fl">87</span>,</span></span>
<span class="r-in"><span>  repeat_size <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_traces.html">plot_traces</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">170</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="call_repeats-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use different algorithms to call the repeats to ensure only periodic peaks are called</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fft to automatically find peak period</span></span></span>
<span class="r-in"><span><span class="fu">call_repeats</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fragments_list</span>,</span></span>
<span class="r-in"><span>  repeat_calling_algorithm <span class="op">=</span> <span class="st">"fft"</span>,</span></span>
<span class="r-in"><span>  assay_size_without_repeat <span class="op">=</span> <span class="fl">87</span>,</span></span>
<span class="r-in"><span>  repeat_size <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_traces.html">plot_traces</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">170</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="call_repeats-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># size_period to manually supply the peak period</span></span></span>
<span class="r-in"><span><span class="fu">call_repeats</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fragments_list</span>,</span></span>
<span class="r-in"><span>  repeat_calling_algorithm <span class="op">=</span> <span class="st">"size_period"</span>,</span></span>
<span class="r-in"><span>  repeat_calling_algorithm_size_period <span class="op">=</span> <span class="fl">2.75</span>,</span></span>
<span class="r-in"><span>  assay_size_without_repeat <span class="op">=</span> <span class="fl">87</span>,</span></span>
<span class="r-in"><span>  repeat_size <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_traces.html">plot_traces</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">170</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use force_whole_repeat_units algorithm to make sure called</span></span></span>
<span class="r-in"><span><span class="co"># repeats are the exact number of bp apart</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">call_repeats</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fragments_list</span>,</span></span>
<span class="r-in"><span>  force_whole_repeat_units <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  assay_size_without_repeat <span class="op">=</span> <span class="fl">87</span>,</span></span>
<span class="r-in"><span>  repeat_size <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_traces.html">plot_traces</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">170</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="call_repeats-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachariah McLean, Kevin Correia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

