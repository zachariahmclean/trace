<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tandem Repeat Analysis by Capillary Electrophoresis • trace</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tandem Repeat Analysis by Capillary Electrophoresis">
<meta name="description" content="The goal of package is to provide a pipeline for short tandem repeat instability analysis from fragment analysis data. This package takes inputs of fsa files or peak tables (eg Genemapper5 software output), and a user supplied metadata data-frame. The package identifies ladders, calls peaks, identifies the modal peaks, calls repeats, then calculates repeat instability metrics (ie expansion index or average repeat gain).">
<meta property="og:description" content="The goal of package is to provide a pipeline for short tandem repeat instability analysis from fragment analysis data. This package takes inputs of fsa files or peak tables (eg Genemapper5 software output), and a user supplied metadata data-frame. The package identifies ladders, calls peaks, identifies the modal peaks, calls repeats, then calculates repeat instability metrics (ie expansion index or average repeat gain).">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">trace</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/plotting_traces.html">Plotting traces</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="tandem-repeat-analysis-from-capillary-electrophoresis-trace">Tandem Repeat Analysis from Capillary Electrophoresis (trace)<a class="anchor" aria-label="anchor" href="#tandem-repeat-analysis-from-capillary-electrophoresis-trace"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>This package provides a pipeline for short tandem repeat instability analysis from fragment analysis data. The inputs are fsa files or peak tables (e.g. Genemapper 5 software peak table output), and a user supplied metadata data-frame. The functions identify ladders, calls peaks, and calculate repeat instability metrics (i.e. expansion index or average repeat gain).</p>
<p>This code is not for clinical use. There are features for accurate repeat sizing if you use validated control samples, but integer repeat units are not returned.</p>
<p>To report bugs or feature requests, please visit the Github issue tracker <a href="https://github.com/zachariahmclean/trace/issues" class="external-link">here</a>. For assistance or any other inquires, contact <a href="mailto:zmclean@mgh.harvard.edu?subject=%5BGitHub%5D%20trace">Zach McLean</a>.</p>
<p>If you use this package, please cite <a href="https://www.nature.com/articles/s41467-024-47485-0" class="external-link">this</a> paper for now.</p>
</div>
<div class="section level1">
<h1 id="how-to-use-the-package">How to use the package<a class="anchor" aria-label="anchor" href="#how-to-use-the-package"></a>
</h1>
<p>For an easy way to get started with your own data or to run an example, use <code><a href="reference/generate_trace_template.html">trace::generate_trace_template()</a></code> to generate a document with the pipeline pre-populated.</p>
<p>In this package, each sample is represented by an R6 ‘fragments’ object, which are organized in lists. Functions in the package iterate over these lists, so you usually don’t need to interact with the objects directly. If you do, the attributes of the objects can be accessed with $, and note that most functions modify the objects in place, so re-assignment isn’t necessary. The only exception to that <code><a href="reference/find_fragments.html">find_fragments()</a></code>, which transitions to a new object since the class structure changes.</p>
<p>There are several important factors to a successful repeat instability experiment and things to consider when using this package:</p>
<ul>
<li><p>(required) Each sample has a unique id, usually the file name</p></li>
<li><p>(optional) Baseline control for your experiment. For example, specifying a sample where the modal allele is the inherited repeat length (eg a mouse tail sample) or a sample at the start of a time-course experiment. This is indicated with a <code>TRUE</code> in the <code>metrics_baseline_control</code> column of the metadata. Samples are then grouped together with the <code>metrics_group_id</code> column of the metadata. Multiple samples can be <code>metrics_baseline_control</code>, which can be helpful for the average repeat gain metric to have a more accurate representation of the average repeat at the start of the experiment.</p></li>
<li>
<p>(optional) Batch or repeat length correction for systematic batch effects that occur with repeat-containing amplicons in capillary electrophoresis.</p>
<ul>
<li><p>Repeat containing amplicons do not run linearly with internal ladder sizes in capillary electrophoresis resulting is an underestimation of repeat length if you just convert from base-pair size. These differences are not always consistent across runs which can result in batch effects in the repeat size. So, if the repeat length is to be directly compared for samples from different runs, this batch effect needs to be corrected. This is only relevant when the absolute size of a amplicons are compared for grouping metrics as described above (otherwise instability metrics are all relative and it doesn’t matter that there’s systematic batch effects across runs), when plotting traces from different runs, or if an accurate repeat length is desired.</p></li>
<li><p>There are two main correction approaches that are somewhat related: either ‘batch’ or ‘repeat’ in <code><a href="reference/call_repeats.html">call_repeats()</a></code>. Batch correction is relatively simple and just requires you to link samples across batches by indicating them from metadata. But even though the repeat size that is return will be precise, it will not be accurate and underestimates the real repeat length. By contrast, repeat correction can be used to accurately call repeat lengths (which also corrects the batch effects). However, the repeat correction will only be as good as your sample(s) used to call the repeat length, so this can a challenging and advanced feature. You need to use a sample that reliably returns the same peak as the modal peak, or you need to be willing to understand the shape of the distribution and manually validate the repeat length of each control sample for each run.</p></li>
</ul>
</li>
<li><p>If starting from fsa files, the GeneScan™ 1200 LIZ™ dye Size Standard ladder assignment may not work very well. The ladder identification algorithm is optimized for GeneScan™ 500 LIZ™ or GeneScan™ 600 LIZ™ or other ladders with relatively few peaks. The 1200 LIZ™ ladder has a challenging pattern of ladder peaks to automatically assign. However, these ladders can be fixed by playing with the various parameters or manually with the built-in fix_ladders_interactive() app.</p></li>
</ul>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>You can install from <a href="https://github.com/zachariahmclean/trace" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"zachariahmclean/trace"</span><span class="op">)</span></span></code></pre></div>
<p>Then load the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zachariahmclean.github.io/trace/">trace</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h1>
<p>First, we read in the raw data. In this case we will used example data within this package, but usually this would be fsa files that are read in using <code><a href="reference/read_fsa.html">read_fsa()</a></code>. The example data is also cloned since the next step modifies the object in place.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fsa_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cell_line_fsa_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="find-ladders">Find ladders<a class="anchor" aria-label="anchor" href="#find-ladders"></a>
</h1>
<p>The known ladder sizes are assigned to peaks in the ladder channel and bp are predicted for each scan.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/find_ladders.html">find_ladders</a></span><span class="op">(</span></span>
<span>  <span class="va">fsa_list</span>,</span>
<span>  show_progress_bar <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>visually inspect each ladder to make sure that the ladders were correctly assigned</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_ladders.html">plot_ladders</a></span><span class="op">(</span><span class="va">fsa_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_ladders-1.png" width="100%"></p>
<p>If the ladders are are not assigned correctly, you can adjust parameters or manually using the built-in fix_ladders_interactive() app.</p>
<p><img src="reference/figures/ladder_fixing.gif"></p>
</div>
<div class="section level1">
<h1 id="find-fragments">Find fragments<a class="anchor" aria-label="anchor" href="#find-fragments"></a>
</h1>
<p>The fragment peaks are identified in the raw continuous trace data. These objects are assigned because find_fragments transitions to a new object since the class structure changes. This reflects the data moving from a continuous trace to a peak table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragments_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/find_fragments.html">find_fragments</a></span><span class="op">(</span></span>
<span>  <span class="va">fsa_list</span>,</span>
<span>  min_bp_size <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Visually inspect the traces and called peaks to make sure they were correctly assigned.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_traces.html">plot_traces</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">550</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1200</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_traces-1.png" width="100%"></p>
<p>Alternatively, this is where you would use data exported from Genemapper if you would rather use the Genemapper bp sizing and peak identification algorithms. However, this is not recommended as some of the functionality of this package would not be accessible (mainly in <code><a href="reference/call_repeats.html">call_repeats()</a></code>, with <code>batch_correction</code> and repeat calling algorithms)</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragments_list_genemapper</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/peak_table_to_fragments.html">peak_table_to_fragments</a></span><span class="op">(</span><span class="va">example_data</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"genemapper5"</span>,</span>
<span>  dye_channel <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>  min_size_bp <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="add-metadata">Add metadata<a class="anchor" aria-label="anchor" href="#add-metadata"></a>
</h1>
<p>Metadata can be incorporated to allow additional functionality in <code><a href="reference/call_repeats.html">call_repeats()</a></code> (batch or repeat correction) and <code><a href="reference/assign_index_peaks.html">assign_index_peaks()</a></code> (assigning index peak from another sample). Prepare a file (eg spreadsheet saved as .csv) with the following columns. If you use the specified column names, it will be automatically parsed by <code><a href="reference/add_metadata.html">add_metadata()</a></code>, otherwise you will need to match up which column name belongs to which metadata category (as done below in <code><a href="reference/add_metadata.html">add_metadata()</a></code>):</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Metadata table column</th>
<th>Functionality metadata is associated with</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>unique_id</td>
<td>Required for adding metadata using <code><a href="reference/add_metadata.html">add_metadata()</a></code>
</td>
<td>The unique identifier for the fsa file. Usually the sample file name. This must be unique, including across runs.</td>
</tr>
<tr class="even">
<td>metrics_group_id</td>
<td>
<code><a href="reference/assign_index_peaks.html">assign_index_peaks()</a></code>, allows setting <code>grouped</code>
</td>
<td>This groups the samples for instability metric calculations. Provide a group id value for each sample. For example, in a mouse experiment and using the expansion index, you need to group the samples since they have the same metrics baseline control (eg inherited repeat length), so provide the mouse id.</td>
</tr>
<tr class="odd">
<td>metrics_baseline_control</td>
<td>
<code><a href="reference/assign_index_peaks.html">assign_index_peaks()</a></code>, allows setting <code>grouped</code>
</td>
<td>This is related to metrics_group_id. Indicate with ‘TRUE’ to specify which sample is the baseline control (eg mouse tail for inherited repeat length, or day-zero sample in cell line experiments)</td>
</tr>
<tr class="even">
<td>batch_run_id</td>
<td>
<code><a href="reference/call_repeats.html">call_repeats()</a></code>, allows setting <code>correction</code> = “batch” or “repeat”</td>
<td>This groups the samples by batch. Provide a value for each fragment analysis run (eg date).</td>
</tr>
<tr class="odd">
<td>batch_sample_id</td>
<td>
<code><a href="reference/call_repeats.html">call_repeats()</a></code>, allows setting <code>correction</code> = “batch” or “repeat”</td>
<td>This groups the samples across batches. Give a unique sample id to each different sample.</td>
</tr>
<tr class="even">
<td>batch_sample_modal_repeat</td>
<td>
<code><a href="reference/call_repeats.html">call_repeats()</a></code>, allows setting <code>correction</code> = “repeat”</td>
<td>The validated modal repeat length for the particular <code>batch_sample_id</code> sample used to accurately call repeat length.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span></span>
<span>  fragments_list <span class="op">=</span> <span class="va">fragments_list</span>,</span>
<span>  metadata_data.frame <span class="op">=</span> <span class="va">metadata</span>,</span>
<span>  unique_id <span class="op">=</span> <span class="st">"unique_id"</span>,</span>
<span>  metrics_group_id <span class="op">=</span> <span class="st">"metrics_group_id"</span>,</span>
<span>  metrics_baseline_control <span class="op">=</span> <span class="st">"metrics_baseline_control"</span>,</span>
<span>  batch_run_id <span class="op">=</span> <span class="st">"batch_run_id"</span>,</span>
<span>  batch_sample_id <span class="op">=</span> <span class="st">"batch_sample_id"</span>,</span>
<span>  batch_sample_modal_repeat <span class="op">=</span> <span class="st">"batch_sample_modal_repeat"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="identify-modal-peaks-and-call-repeats">Identify modal peaks and call repeats<a class="anchor" aria-label="anchor" href="#identify-modal-peaks-and-call-repeats"></a>
</h1>
<p>Next we identify the modal peaks with <code><a href="reference/find_alleles.html">find_alleles()</a></code> and convert the base pair fragments to repeats with <code><a href="reference/call_repeats.html">call_repeats()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/find_alleles.html">find_alleles</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/call_repeats.html">call_repeats</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">)</span></span></code></pre></div>
<p>We can view the distribution of repeat sizes and the identified modal peak with a plotting function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_traces.html">plot_traces</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">110</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_fragments-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="assign-index-peaks">Assign index peaks<a class="anchor" aria-label="anchor" href="#assign-index-peaks"></a>
</h1>
<p>A key part of several instability metrics is the index peak. This is the repeat length used as the reference for relative instability metrics calculations, like expansion index or average repeat gain. In the metadata, samples are grouped by a <code>metrics_group_id</code> and a subset of the samples are set as <code>metrics_baseline_control</code>, meaning they are the samples taken at day 0 in this experiment. This allows us to set <code>grouped = TRUE</code> and set the index peak for the expansion index and other metrics. For mice, if just a few samples have the inherited repeat signal shorter than the expanded population, you could not worry about this and instead use the <code>index_override_dataframe</code> in <code><a href="reference/assign_index_peaks.html">assign_index_peaks()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/assign_index_peaks.html">assign_index_peaks</a></span><span class="op">(</span></span>
<span>  <span class="va">fragments_list</span>,</span>
<span>  grouped <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can validate that the index peaks were assigned correctly with a dotted vertical line added to the trace. This is perhaps more useful in the context of mice where you can visually see when the inherited repeat length should be in the bimodal distribution.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_traces.html">plot_traces</a></span><span class="op">(</span><span class="va">fragments_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">110</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-2-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="calculate-instability-metrics">Calculate instability metrics<a class="anchor" aria-label="anchor" href="#calculate-instability-metrics"></a>
</h1>
<p>All of the information we need to calculate the repeat instability metrics has now been identified. We can finally use <code>calculate_instability_metrics</code> to generate a dataframe of per-sample metrics.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metrics_grouped_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculate_instability_metrics.html">calculate_instability_metrics</a></span><span class="op">(</span></span>
<span>  fragments_list <span class="op">=</span> <span class="va">fragments_list</span>,</span>
<span>  peak_threshold <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>These metrics can then be used to quantify repeat instability. For example, this reproduces Figure 7e of <a href="https://www.nature.com/articles/s41467-024-47485-0" class="external-link">our manuscript</a>.</p>
<p>First, prepare the data for plotting by removing poor quality samples and finding the average repeat gain relative to the DMSO group for each cell line</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">metrics_grouped_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">unique_id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">day</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>    <span class="va">modal_peak_signal</span> <span class="op">&gt;</span> <span class="fl">500</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">metrics_group_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    rel_gain <span class="op">=</span> <span class="va">average_repeat_gain</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">average_repeat_gain</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    genotype <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu">fct_rev</span><span class="op">(</span><span class="va">genotype</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Then we can plot the instability metrics</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">plot_data</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">genotype</span>, <span class="va">rel_gain</span>, colour <span class="op">=</span> <span class="va">genotype</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Average repeat gain\n(relative to DMSO)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"PMS1 pseudoexon status"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-ggplot-1.png" width="100%"></p>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing trace</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Zachariah McLean <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-0968-0538" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Kevin Correia <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/zachariahmclean/trace/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/zachariahmclean/trace/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachariah McLean, Kevin Correia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
